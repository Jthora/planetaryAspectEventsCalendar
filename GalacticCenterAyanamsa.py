
# Moon phases and emojis
LUNAR_MOON_PHASES = {
    0: "🌑 New Moon",
    1: "🌓 1st Quarter Moon",
    2: "🌕 Full Moon",
    3: "🌗 3rd Quarter Moon"
}

# Cultural moon names for Full Moons
LUNAR_CULTURAL_MOON_NAMES = {
    1: "Wolf",
    2: "Snow",
    3: "Worm",
    4: "Pink",
    5: "Flower",
    6: "Strawberry",
    7: "Buck",
    8: "Sturgeon",
    9: "Harvest",
    10: "Hunter's",
    11: "Beaver",
    12: "Cold"
}

# Cultural significance for Full Moons
LUNAR_CULTURAL_SIGNIFICANCES = {
    "Wolf": "The Wolf Moon is deeply tied to the haunting howls of wolves that echo through the cold winter air, symbolizing survival and community in harsh conditions. It serves as a reminder of the strong bonds within wolf packs and the importance of perseverance. This moon has often inspired tales and myths of transformation and primal instincts.",
    "Snow": "The Snow Moon represents the heaviest snowfalls of the year, blanketing the earth in quiet stillness. It reflects the challenges of enduring the harshness of winter while finding beauty in the frozen landscapes. Many cultures see this moon as a time to gather together and share warmth and stories by the fire.",
    "Worm": "The Worm Moon signifies the thawing earth as spring approaches, with earthworms emerging to rejuvenate the soil. This moon celebrates the return of fertility and the cycles of renewal, marking a time for planting and new beginnings. Its name reflects a connection to the rhythms of nature and the changing of the seasons.",
    "Pink": "The Pink Moon gets its name from the first vibrant blooms of wild pink phlox, heralding the arrival of spring. It symbolizes renewal, growth, and the awakening of life after the cold winter months. This moon is often associated with hope, beauty, and the reemergence of color in the natural world.",
    "Flower": "The Flower Moon celebrates the abundance of blooming flowers in May, a time of lush growth and beauty. It embodies the energy of fertility, creativity, and the flourishing of life. Many cultures see this moon as a time to honor the earth’s generosity and participate in rituals of gratitude.",
    "Strawberry": "The Strawberry Moon marks the peak of the strawberry harvest, bringing sweetness and nourishment to summer. It symbolizes abundance, prosperity, and the rewards of hard work. This moon is often celebrated with gatherings and feasts, reflecting the joy of nature’s bounty.",
    "Buck": "The Buck Moon signifies the growth of antlers on young bucks, a powerful symbol of strength and vitality. It reflects a time of personal development, preparation, and stepping into one's power. This moon has long been associated with the wild energy of nature and the cycle of maturity.",
    "Sturgeon": "The Sturgeon Moon is named for the large sturgeon fish caught in abundance during August, a crucial time for survival in many communities. It highlights the relationship between humanity and water, symbolizing sustenance and the gifts of the rivers and lakes. This moon is often linked to themes of gratitude and interdependence.",
    "Harvest": "The Harvest Moon illuminates the fields during the critical time of reaping crops, allowing farmers to work late into the night. It symbolizes hard work, fulfillment, and the rewards of dedication. This moon is celebrated as a time of gathering and preparing for the winter ahead.",
    "Hunter's": "The Hunter's Moon marks the season of hunting game, providing resources for the harsh months of winter. It is a symbol of self-reliance, strategy, and the balance between giving and taking from nature. This moon has inspired many traditional rituals and celebrations of the hunt.",
    "Beaver": "The Beaver Moon reflects the industrious nature of beavers building their winter dams, a reminder of the importance of preparation and community. It symbolizes resilience, resourcefulness, and working together to create security for the future. This moon often carries a sense of determination and focus.",
    "Cold": "The Cold Moon marks the longest nights of the year and the deep chill of December, symbolizing endurance and reflection. It invites introspection and quiet moments to appreciate the stillness of winter. This moon is a time for rest and finding inner warmth amidst the season’s challenges."
}

# Zodiac signs, emoji, and descriptions
ZODIAC_SIGNS_EMOJI_AND_SYMBOLS = {
    'Aries': {
        'symbol': '♈',
        'zodiac_combo_glyph': '<🜂>',
        'zodiac_element_glyph': '🜂',
        'modality_opening_bracket': '<',
        'modality_closing_bracket': '>',
        'modality_and_element': 'Cardinal Fire',
        'modality_symbol': '▲',
        'element_emoji': '🔥',
        'color_code': '🟥'
    },
    'Taurus': {
        'symbol': '♉',
        'zodiac_combo_glyph': '[🜃]',
        'zodiac_element_glyph': '🜃',
        'modality_opening_bracket': '[',
        'modality_closing_bracket': ']',
        'modality_and_element': 'Fixed Earth',
        'modality_symbol': '■',
        'element_emoji': '⛰️',
        'color_code': '🟩'
    },
    'Gemini': {
        'symbol': '♊',
        'zodiac_combo_glyph': '(🜁)',
        'zodiac_element_glyph': '🜁',
        'modality_opening_bracket': '(',
        'modality_closing_bracket': ')',
        'modality_and_element': 'Mutable Air',
        'modality_symbol': '●',
        'element_emoji': '💨',
        'color_code': '🟨'
    },
    'Cancer': {
        'symbol': '♋',
        'zodiac_combo_glyph': '<🜄>',
        'zodiac_element_glyph': '🜄',
        'modality_opening_bracket': '<',
        'modality_closing_bracket': '>',
        'modality_and_element': 'Cardinal Water',
        'modality_symbol': '▲',
        'element_emoji': '💧',
        'color_code': '🟦'
    },
    'Leo': {
        'symbol': '♌',
        'zodiac_combo_glyph': '[🜂]',
        'zodiac_element_glyph': '🜂',
        'modality_opening_bracket': '[',
        'modality_closing_bracket': ']',
        'modality_and_element': 'Fixed Fire',
        'modality_symbol': '■',
        'element_emoji': '🔥',
        'color_code': '🟥'
    },
    'Virgo': {
        'symbol': '♍',
        'zodiac_combo_glyph': '(🜃)',
        'zodiac_element_glyph': '🜃',
        'modality_opening_bracket': '(',
        'modality_closing_bracket': ')',
        'modality_and_element': 'Mutable Earth',
        'modality_symbol': '●',
        'element_emoji': '⛰️',
        'color_code': '🟩'
    },
    'Libra': {
        'symbol': '♎',
        'zodiac_combo_glyph': '<🜁>',
        'zodiac_element_glyph': '🜁',
        'modality_opening_bracket': '<',
        'modality_closing_bracket': '>',
        'modality_and_element': 'Cardinal Air',
        'modality_symbol': '▲',
        'element_emoji': '💨',
        'color_code': '🟨'
    },
    'Scorpio': {
        'symbol': '♏',
        'zodiac_combo_glyph': '[🜄]',
        'zodiac_element_glyph': '🜄',
        'modality_opening_bracket': '[',
        'modality_closing_bracket': ']',
        'modality_and_element': 'Fixed Water',
        'modality_symbol': '■',
        'element_emoji': '💧',
        'color_code': '🟦'
    },
    'Sagittarius': {
        'symbol': '♐',
        'zodiac_combo_glyph': '(🜂)',
        'zodiac_element_glyph': '🜂',
        'modality_opening_bracket': '(',
        'modality_closing_bracket': ')',
        'modality_and_element': 'Mutable Fire',
        'modality_symbol': '●',
        'element_emoji': '🔥',
        'color_code': '🟥'
    },
    'Capricorn': {
        'symbol': '♑',
        'zodiac_combo_glyph': '<🜃>',
        'zodiac_element_glyph': '🜃',
        'modality_opening_bracket': '<',
        'modality_closing_bracket': '>',
        'modality_and_element': 'Cardinal Earth',
        'modality_symbol': '▲',
        'element_emoji': '⛰️',
        'color_code': '🟩'
    },
    'Aquarius': {
        'symbol': '♒',
        'zodiac_combo_glyph': '[🜁]',
        'zodiac_element_glyph': '🜁',
        'modality_opening_bracket': '[',
        'modality_closing_bracket': ']',
        'modality_and_element': 'Fixed Air',
        'modality_symbol': '■',
        'element_emoji': '💨',
        'color_code': '🟨'
    },
    'Pisces': {
        'symbol': '♓',
        'zodiac_combo_glyph': '(🜄)',
        'zodiac_element_glyph': '🜄',
        'modality_opening_bracket': '(',
        'modality_closing_bracket': ')',
        'modality_and_element': 'Mutable Water',
        'modality_symbol': '●',
        'element_emoji': '💧',
        'color_code': '🟦'
    }
}

# Galactic Center Ayanamsa Constants
GALACTIC_CENTER_REFERENCE_POSITION = 26.854  # Galactic Center position in degrees (year 2000)
GALACTIC_CENTER_REFERENCE_YEAR = 2000 # Base year for Galactic Center alignment
EARTH_PRECESSION_RATE = 0.01397 # Degrees per year due to precession

# Zodiac Signs and Degree Ranges
ZODIAC_SIGN_DEGREE_RANGES = [
    ('Aries', 0, 30), ('Taurus', 30, 60), ('Gemini', 60, 90),
    ('Cancer', 90, 120), ('Leo', 120, 150), ('Virgo', 150, 180),
    ('Libra', 180, 210), ('Scorpio', 210, 240), ('Sagittarius', 240, 270),
    ('Capricorn', 270, 300), ('Aquarius', 300, 330), ('Pisces', 330, 360)
]

# Fractional Year
def fractional_year(date_str, time_str):
    date_time = datetime.strptime(f"{date_str} {time_str}", "%b %d, %Y %H:%M")
    year = date_time.year
    start_of_year = datetime(year, 1, 1)
    day_of_year = (date_time - start_of_year).total_seconds() / 86400
    return year + (day_of_year / 365.25)

# Galactic Center Sag 0º Ayanamsa Calculations
def calculate_ayanamsa(fractional_year):
    return GALACTIC_CENTER_REFERENCE_POSITION - (fractional_year - GALACTIC_CENTER_REFERENCE_YEAR) * EARTH_PRECESSION_RATE

def adjust_position(position, ayanamsa):
    corrected_position = position - ayanamsa
    return corrected_position % 360  # Wrap around 0-360

def calculate_galactic_center(longitude, datetime_obj, adjust_with_gc=True):
    """
    Calculate the Galactic Center correction for a given longitude and datetime object.

    Parameters:
        longitude (float): The apparent longitude in degrees to be corrected.
        datetime_obj (datetime): A datetime object representing the time for which the calculation is done.
        adjust_with_gc (bool): Whether to apply the Galactic Center correction. Defaults to True.

    Returns:
        dict: A dictionary containing:
            - 'original_longitude' (float): The original longitude in degrees.
            - 'corrected_longitude' (float): The longitude after applying Galactic Center correction.
            - 'galactic_center' (float): The calculated Galactic Center position in degrees.
            - 'fractional_year' (float): The fractional year used for Galactic Center calculation.

    Raises:
        ValueError: If inputs are invalid or datetime conversion fails.
        Exception: For unexpected errors during the calculation.
    """
    try:
        # Validate inputs
        if not isinstance(longitude, (int, float)):
            raise ValueError("Longitude must be a number (int or float).")
        if not hasattr(datetime_obj, "timetuple"):
            raise ValueError("Invalid datetime object provided.")

        # Calculate fractional year
        year = datetime_obj.year
        day_of_year = datetime_obj.timetuple().tm_yday
        fractional_year = year + (day_of_year / 365.25)

        # Calculate Galactic Center position (ayanamsa) based on fractional year
        try:
            galactic_center = calculate_ayanamsa(fractional_year)  # Replace with actual function
        except Exception as e:
            logging.error(f"Error in Galactic Center calculation: {e}", exc_info=True)
            raise RuntimeError("Galactic Center calculation failed.") from e

        # Apply correction to longitude
        if adjust_with_gc:
            try:
                corrected_longitude = adjust_position(longitude, galactic_center)  # Replace with actual function
            except Exception as e:
                logging.error(f"Error in longitude adjustment: {e}", exc_info=True)
                raise RuntimeError("Longitude adjustment with Galactic Center failed.") from e
        else:
            corrected_longitude = longitude

        # Return results
        return {
            "original_longitude": longitude,
            "corrected_longitude": corrected_longitude,
            "galactic_center": galactic_center,
            "fractional_year": fractional_year,
        }

    except ValueError as ve:
        logging.error(f"Input validation error: {ve}", exc_info=True)
        raise
    except Exception as e:
        logging.error(f"Unexpected error in calculate_galactic_center: {e}", exc_info=True)
        raise